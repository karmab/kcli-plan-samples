parameters:
 memory: 4096
 numcpus: 4
 image: ubuntu1804
 domain: karmalabs.com
 nodes: 1

microshift_profile:
 type: profile
 domain: {{ domain }}
 image: {{ image }}
 memory: {{ memory }}
 numcpus: {{ numcpus }}
 files:
 - path: /etc/profile.d/microshift.sh
   mode: 644
   content: |
     export PATH=/usr/local/bin:$PATH
     export KUBECONFIG=/var/lib/microshift/resources/kubeadmin/kubeconfig
 cmds:
 - apt-get update
 - HOME=/root curl -sfL https://raw.githubusercontent.com/redhat-et/microshift/main/install.sh | bash

{% for number in range(0, nodes) %}
microshift-{{ number }}:
  profile: microshift_profile
{% endfor %}
